/**
 * @copyright Copyright The SimpleKernel Contributors
 */

#ifndef SIMPLEKERNEL_SRC_LIBCXX_INCLUDE_SK_UNORDERED_MAP_
#define SIMPLEKERNEL_SRC_LIBCXX_INCLUDE_SK_UNORDERED_MAP_

#include <cstddef>
#include <functional>

#include "kstd_pool.hpp"
#include "kstd_unordered_map"

namespace sk_std {

using kstd::unordered_map;

/**
 * @brief Fixed-capacity unordered map with internal static storage.
 */
template <typename Key, typename Value, size_t MaxSize, size_t MaxBuckets,
          typename Hash = std::hash<Key>, typename KeyEqual = std::equal_to<Key>>
class static_unordered_map : public kstd::unordered_map<Key, Value, Hash, KeyEqual> {
 public:
  using Base = kstd::unordered_map<Key, Value, Hash, KeyEqual>;
  using Node = typename Base::node_type;

  static_unordered_map() : Base(pool_, buckets_, MaxBuckets) {}

  static_unordered_map(const Hash& hash, const KeyEqual& equal)
      : Base(pool_, buckets_, MaxBuckets, hash, equal) {}

  // Delete copy/move as it contains internal storage and Base holds references to it.
  static_unordered_map(const static_unordered_map&) = delete;
  static_unordered_map(static_unordered_map&&) = delete;
  auto operator=(const static_unordered_map&) -> static_unordered_map& = delete;
  auto operator=(static_unordered_map&&) -> static_unordered_map& = delete;

 private:
  kstd::Pool<Node, MaxSize> pool_;
  void* buckets_[MaxBuckets];
};

}  // namespace sk_std

#endif /* SIMPLEKERNEL_SRC_LIBCXX_INCLUDE_SK_UNORDERED_MAP_ */
