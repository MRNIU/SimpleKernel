# NS16550A UART 驱动

NS16550A 是一款兼容 16550 的通用异步接收器发送器 (UART)，广泛用于 RISC-V 架构的串口通信。

## 功能特性

- 支持 8 位数据位配置
- 支持可配置波特率
- 支持 FIFO 缓冲
- 支持接收中断
- 兼容标准 16550 寄存器布局

## 类接口

### 构造函数
```cpp
Ns16550a(uint64_t dev_addr)
```
- `dev_addr`: 设备基地址

### 主要方法
```cpp
void PutChar(uint8_t c) const
```
发送单个字符到串口

## 初始化配置

驱动在构造时自动进行以下初始化：
- 禁用中断
- 设置波特率（使用除数锁存器）
- 配置为 8 位数据位
- 启用 FIFO
- 启用接收中断

## 使用示例

```cpp
// 创建 NS16550A 实例
Ns16550a uart(0x10000000);

// 发送字符
uart.PutChar('H');
uart.PutChar('e');
uart.PutChar('l');
uart.PutChar('l');
uart.PutChar('o');
```

## 设备树配置示例

```dts
serial@10000000 {
    interrupts = <0x0a>;
    interrupt-parent = <0x03>;
    clock-frequency = "\08@";
    reg = <0x00 0x10000000 0x00 0x100>;
    compatible = "ns16550a";
};
```

## 寄存器映射

驱动实现了标准的 NS16550A 寄存器布局：

| 偏移 | 读模式 | 写模式 | 描述 |
|------|--------|--------|------|
| 0x00 | RHR | THR | 接收/发送保持寄存器 |
| 0x01 | - | IER | 中断使能寄存器 |
| 0x02 | ISR | FCR | 中断状态/FIFO控制寄存器 |
| 0x03 | - | LCR | 线控制寄存器 |
| 0x04 | - | MCR | 调制解调器控制寄存器 |
| 0x05 | LSR | - | 线状态寄存器 |
| 0x06 | MSR | - | 调制解调器状态寄存器 |

### 除数锁存器（当 LCR.DLAB=1 时）
| 偏移 | 寄存器 | 描述 |
|------|--------|------|
| 0x00 | DLL | 除数锁存器低字节 |
| 0x01 | DLM | 除数锁存器高字节 |

## 注意事项

- 在 RISC-V 架构中，该驱动目前主要用于直接硬件访问
- 当前实现中 RISC-V 架构使用 OpenSBI 进行控制台输出
- 驱动支持轮询模式的字符发送
- 发送前会检查发送缓冲区状态，确保可以安全发送

## 文件结构

- `include/ns16550a.h` - 头文件，包含类定义和寄存器常量
- `ns16550a.cpp` - 实现文件，包含初始化和字符输出功能
- `CMakeLists.txt` - 构建配置
